const fetch = require('node-fetch');
const axios = require('axios');

// Fungsi untuk mengonversi kode negara ke nama lengkap dengan bendera
const mooCountry = (value) => {
  const regionMap = {
        AF: 'Afganistan ðŸ‡¦ðŸ‡«',
        AX: 'Kepulauan Aland ðŸ‡¦ðŸ‡½',
        AL: 'Albania ðŸ‡¦ðŸ‡±',
        DZ: 'Aljazair ðŸ‡©ðŸ‡¿',
        AS: 'Samoa Amerika ðŸ‡¦ðŸ‡¸',
        AD: 'Andorra ðŸ‡¦ðŸ‡©',
        AO: 'Angola ðŸ‡¦ðŸ‡´',
        AI: 'Anguilla ðŸ‡¦ðŸ‡®',
        AQ: 'Antartika ðŸ‡¦ðŸ‡¶',
        AG: 'Antigua dan Barbuda ðŸ‡¦ðŸ‡¬',
        AR: 'Argentina ðŸ‡¦ðŸ‡·',
        AM: 'Armenia ðŸ‡¦ðŸ‡²',
        AW: 'Aruba ðŸ‡¦ðŸ‡¼',
        AU: 'Australia ðŸ‡¦ðŸ‡º',
        AT: 'Austria ðŸ‡¦ðŸ‡¹',
        AZ: 'Azerbaijan ðŸ‡¦ðŸ‡¿',
        BS: 'Bahama ðŸ‡§ðŸ‡¸',
        BH: 'Bahrain ðŸ‡§ðŸ‡­',
        BD: 'Bangladesh ðŸ‡§ðŸ‡©',
        BB: 'Barbados ðŸ‡§ðŸ‡§',
        BY: 'Belarus ðŸ‡§ðŸ‡¾',
        BE: 'Belgia ðŸ‡§ðŸ‡ª',
        BZ: 'Belize ðŸ‡§ðŸ‡¿',
        BJ: 'Benin ðŸ‡§ðŸ‡¯',
        BM: 'Bermuda ðŸ‡§ðŸ‡²',
        BT: 'Bhutan ðŸ‡§ðŸ‡¹',
        BO: 'Bolivia ðŸ‡§ðŸ‡´',
        BQ: 'Bonaire, Sint Eustatius dan Saba ðŸ‡§ðŸ‡¶',
        BA: 'Bosnia dan Herzegovina ðŸ‡§ðŸ‡¦',
        BW: 'Botswana ðŸ‡§ðŸ‡¼',
        BV: 'Pulau Bouvet ðŸ‡§ðŸ‡»',
        BR: 'Brazil ðŸ‡§ðŸ‡·',
        IO: 'Wilayah Samudra Hindia Britania ðŸ‡®ðŸ‡´',
        BN: 'Brunei Darussalam ðŸ‡§ðŸ‡³',
        BG: 'Bulgaria ðŸ‡§ðŸ‡¬',
        BF: 'Burkina Faso ðŸ‡§ðŸ‡«',
        BI: 'Burundi ðŸ‡§ðŸ‡®',
        CV: 'Cabo Verde ðŸ‡¨ðŸ‡»',
        KH: 'Kamboja ðŸ‡°ðŸ‡­',
        CM: 'Kamerun ðŸ‡¨ðŸ‡²',
        CA: 'Kanada ðŸ‡¨ðŸ‡¦',
        KY: 'Kepulauan Cayman ðŸ‡°ðŸ‡¾',
        CF: 'Republik Afrika Tengah ðŸ‡¨ðŸ‡«',
        TD: 'Chad ðŸ‡¹ðŸ‡©',
        CL: 'Chili ðŸ‡¨ðŸ‡±',
        CN: 'Tiongkok ðŸ‡¨ðŸ‡³',
        CX: 'Pulau Natal ðŸ‡¨ðŸ‡½',
        CC: 'Kepulauan Cocos (Keeling) ðŸ‡¨ðŸ‡¨',
        CO: 'Kolombia ðŸ‡¨ðŸ‡´',
        KM: 'Komoro ðŸ‡°ðŸ‡²',
        CG: 'Kongo ðŸ‡¨ðŸ‡¬',
        CD: 'Republik Demokratik Kongo ðŸ‡¨ðŸ‡©',
        CK: 'Kepulauan Cook ðŸ‡¨ðŸ‡°',
        CR: 'Kosta Rika ðŸ‡¨ðŸ‡·',
        HR: 'Kroasia ðŸ‡­ðŸ‡·',
        CU: 'Kuba ðŸ‡¨ðŸ‡º',
        CW: 'CuraÃ§ao ðŸ‡¨ðŸ‡¼',
        CY: 'Siprus ðŸ‡¨ðŸ‡¾',
        CZ: 'Republik Ceko ðŸ‡¨ðŸ‡¿',
        DK: 'Denmark ðŸ‡©ðŸ‡°',
        DJ: 'Djibouti ðŸ‡©ðŸ‡¯',
        DM: 'Dominika ðŸ‡©ðŸ‡²',
        DO: 'Republik Dominika ðŸ‡©ðŸ‡´',
        EC: 'Ekuador ðŸ‡ªðŸ‡¨',
        EG: 'Mesir ðŸ‡ªðŸ‡¬',
        SV: 'El Salvador ðŸ‡¸ðŸ‡»',
        GQ: 'Guinea Ekuatorial ðŸ‡¬ðŸ‡¶',
        ER: 'Eritrea ðŸ‡ªðŸ‡·',
        EE: 'Estonia ðŸ‡ªðŸ‡ª',
        ET: 'Etiopia ðŸ‡ªðŸ‡¹',
        FK: 'Kepulauan Falkland (Malvinas) ðŸ‡«ðŸ‡°',
        FO: 'Kepulauan Faroe ðŸ‡«ðŸ‡´',
        FJ: 'Fiji ðŸ‡«ðŸ‡¯',
        FI: 'Finlandia ðŸ‡«ðŸ‡®',
        FR: 'Prancis ðŸ‡«ðŸ‡·',
        GF: 'Guyana Prancis ðŸ‡¬ðŸ‡«',
        PF: 'Polinesia Prancis ðŸ‡µðŸ‡«',
        TF: 'Wilayah Selatan Prancis ðŸ‡¹ðŸ‡«',
        GA: 'Gabon ðŸ‡¬ðŸ‡¦',
        GM: 'Gambia ðŸ‡¬ðŸ‡²',
        GE: 'Georgia ðŸ‡¬ðŸ‡ª',
        DE: 'Jerman ðŸ‡©ðŸ‡ª',
        GH: 'Ghana ðŸ‡¬ðŸ‡­',
        GI: 'Gibraltar ðŸ‡¬ðŸ‡®',
        GR: 'Yunani ðŸ‡¬ðŸ‡·',
        GL: 'Greenland ðŸ‡¬ðŸ‡±',
        GD: 'Grenada ðŸ‡¬ðŸ‡©',
        GP: 'Guadeloupe ðŸ‡¬ðŸ‡µ',
        GU: 'Guam ðŸ‡¬ðŸ‡º',
        GT: 'Guatemala ðŸ‡¬ðŸ‡¹',
        GG: 'Guernsey ðŸ‡¬ðŸ‡¬',
        GN: 'Guinea ðŸ‡¬ðŸ‡³',
        GW: 'Guinea-Bissau ðŸ‡¬ðŸ‡¼',
        GY: 'Guyana ðŸ‡¬ðŸ‡¾',
        HT: 'Haiti ðŸ‡­ðŸ‡¹',
        HM: 'Pulau Heard dan Kepulauan McDonald ðŸ‡­ðŸ‡²',
        VA: 'Kota Vatikan ðŸ‡»ðŸ‡¦',
        HN: 'Honduras ðŸ‡­ðŸ‡³',
        HK: 'Hong Kong ðŸ‡­ðŸ‡°',
        HU: 'Hungaria ðŸ‡­ðŸ‡º',
        IS: 'Islandia ðŸ‡®ðŸ‡¸',
        IN: 'India ðŸ‡®ðŸ‡³',
        ID: 'Indonesia ðŸ‡®ðŸ‡©',
        IR: 'Iran ðŸ‡®ðŸ‡·',
        IQ: 'Irak ðŸ‡®ðŸ‡¶',
        IE: 'Irlandia ðŸ‡®ðŸ‡ª',
        IM: 'Pulau Man ðŸ‡®ðŸ‡²',
        IL: 'Israel ðŸ‡®ðŸ‡±',
        IT: 'Italia ðŸ‡®ðŸ‡¹',
        JM: 'Jamaika ðŸ‡¯ðŸ‡²',
        JP: 'Jepang ðŸ‡¯ðŸ‡µ',
        JE: 'Jersey ðŸ‡¯ðŸ‡ª',
        JO: 'Yordania ðŸ‡¯ðŸ‡´',
        KZ: 'Kazakhstan ðŸ‡°ðŸ‡¿',
        KE: 'Kenya ðŸ‡°ðŸ‡ª',
        KI: 'Kiribati ðŸ‡°ðŸ‡®',
        KP: 'Korea Utara ðŸ‡°ðŸ‡µ',
        KR: 'Korea Selatan ðŸ‡°ðŸ‡·',
        KW: 'Kuwait ðŸ‡°ðŸ‡¼',
        KG: 'Kirgizstan ðŸ‡°ðŸ‡¬',
        LA: 'Laos ðŸ‡±ðŸ‡¦',
        LV: 'Latvia ðŸ‡±ðŸ‡»',
        LB: 'Lebanon ðŸ‡±ðŸ‡§',
        LS: 'Lesotho ðŸ‡±ðŸ‡¸',
        LR: 'Liberia ðŸ‡±ðŸ‡·',
        LY: 'Libya ðŸ‡±ðŸ‡¾',
        LI: 'Liechtenstein ðŸ‡±ðŸ‡®',
        LT: 'Lituania ðŸ‡±ðŸ‡¹',
        LU: 'Luksemburg ðŸ‡±ðŸ‡º',
        MO: 'Makau ðŸ‡²ðŸ‡´',
        MK: 'Makedonia Utara ðŸ‡²ðŸ‡°',
        MG: 'Madagaskar ðŸ‡²ðŸ‡¬',
        MW: 'Malawi ðŸ‡²ðŸ‡¼',
        MY: 'Malaysia ðŸ‡²ðŸ‡¾',
        MV: 'Maladewa ðŸ‡²ðŸ‡»',
        ML: 'Mali ðŸ‡²ðŸ‡±',
        MT: 'Malta ðŸ‡²ðŸ‡¹',
        MH: 'Kepulauan Marshall ðŸ‡²ðŸ‡­',
        MQ: 'Martinique ðŸ‡²ðŸ‡¶',
        MR: 'Mauritania ðŸ‡²ðŸ‡·',
        MU: 'Mauritius ðŸ‡²ðŸ‡º',
        YT: 'Mayotte ðŸ‡¾ðŸ‡¹',
        MX: 'Meksiko ðŸ‡²ðŸ‡½',
        FM: 'Mikronesia ðŸ‡«ðŸ‡²',
        MD: 'Moldova ðŸ‡²ðŸ‡©',
        MC: 'Monako ðŸ‡²ðŸ‡¨',
        MN: 'Mongolia ðŸ‡²ðŸ‡³',
        ME: 'Montenegro ðŸ‡²ðŸ‡ª',
        MS: 'Montserrat ðŸ‡²ðŸ‡¸',
        MA: 'Maroko ðŸ‡²ðŸ‡¦',
        MZ: 'Mozambik ðŸ‡²ðŸ‡¿',
        MM: 'Myanmar (Burma) ðŸ‡²ðŸ‡²',
        NA: 'Namibia ðŸ‡³ðŸ‡¦',
        NR: 'Nauru ðŸ‡³ðŸ‡·',
        NP: 'Nepal ðŸ‡³ðŸ‡µ',
        NL: 'Belanda ðŸ‡³ðŸ‡±',
        NC: 'Kaledonia Baru ðŸ‡³ðŸ‡¨',
        NZ: 'Selandia Baru ðŸ‡³ðŸ‡¿',
        NI: 'Nikaragua ðŸ‡³ðŸ‡®',
        NE: 'Niger ðŸ‡³ðŸ‡ª',
        NG: 'Nigeria ðŸ‡³ðŸ‡¬',
        NU: 'Niue ðŸ‡³ðŸ‡º',
        NF: 'Pulau Norfolk ðŸ‡³ðŸ‡«',
        MP: 'Kepulauan Mariana Utara ðŸ‡²ðŸ‡µ',
        NO: 'Norwegia ðŸ‡³ðŸ‡´',
        OM: 'Oman ðŸ‡´ðŸ‡²',
        PK: 'Pakistan ðŸ‡µðŸ‡°',
        PW: 'Palau ðŸ‡µðŸ‡¼',
        PS: 'Palestina ðŸ‡µðŸ‡¸',
        PA: 'Panama ðŸ‡µðŸ‡¦',
        PG: 'Papua Nugini ðŸ‡µðŸ‡¬',
        PY: 'Paraguay ðŸ‡µðŸ‡¾',
        PE: 'Peru ðŸ‡µðŸ‡ª',
        PH: 'Filipina ðŸ‡µðŸ‡­',
        PN: 'Pitcairn ðŸ‡µðŸ‡³',
        PL: 'Polandia ðŸ‡µðŸ‡±',
        PT: 'Portugal ðŸ‡µðŸ‡¹',
        PR: 'Puerto Rico ðŸ‡µðŸ‡·',
        QA: 'Qatar ðŸ‡¶ðŸ‡¦',
        RE: 'RÃ©union ðŸ‡·ðŸ‡ª',
        RO: 'Rumania ðŸ‡·ðŸ‡´',
        RU: 'Rusia ðŸ‡·ðŸ‡º',
        RW: 'Rwanda ðŸ‡·ðŸ‡¼',
        BL: 'Saint BarthÃ©lemy ðŸ‡§ðŸ‡±',
        SH: 'Saint Helena ðŸ‡¸ðŸ‡­',
        KN: 'Saint Kitts dan Nevis ðŸ‡°ðŸ‡³',
        LC: 'Saint Lucia ðŸ‡±ðŸ‡¨',
        MF: 'Saint Martin ðŸ‡²ðŸ‡«',
        PM: 'Saint Pierre dan Miquelon ðŸ‡µðŸ‡²',
        VC: 'Saint Vincent dan Grenadines ðŸ‡»ðŸ‡¨',
        WS: 'Samoa ðŸ‡¼ðŸ‡¸',
        SM: 'San Marino ðŸ‡¸ðŸ‡²',
        ST: 'Sao Tome dan Principe ðŸ‡¸ðŸ‡¹',
        SA: 'Arab Saudi ðŸ‡¸ðŸ‡¦',
        SN: 'Senegal ðŸ‡¸ðŸ‡³',
        RS: 'Serbia ðŸ‡·ðŸ‡¸',
        SC: 'Seychelles ðŸ‡¸ðŸ‡¨',
        SL: 'Sierra Leone ðŸ‡¸ðŸ‡±',
        SG: 'Singapura ðŸ‡¸ðŸ‡¬',
        SX: 'Sint Maarten ðŸ‡¸ðŸ‡½',
        SK: 'Slovakia ðŸ‡¸ðŸ‡°',
        SI: 'Slovenia ðŸ‡¸ðŸ‡®',
        SB: 'Kepulauan Solomon ðŸ‡¸ðŸ‡§',
        SO: 'Somalia ðŸ‡¸ðŸ‡´',
        ZA: 'Afrika Selatan ðŸ‡¿ðŸ‡¦',
        GS: 'Georgia Selatan dan Kepulauan Sandwich Selatan ðŸ‡¬ðŸ‡¸',
        SS: 'Sudan Selatan ðŸ‡¸ðŸ‡¸',
        ES: 'Spanyol ðŸ‡ªðŸ‡¸',
        LK: 'Sri Lanka ðŸ‡±ðŸ‡°',
        SD: 'Sudan ðŸ‡¸ðŸ‡©',
        SR: 'Suriname ðŸ‡¸ðŸ‡·',
        SJ: 'Svalbard dan Jan Mayen ðŸ‡¸ðŸ‡¯',
        SE: 'Swedia ðŸ‡¸ðŸ‡ª',
        CH: 'Swiss ðŸ‡¨ðŸ‡­',
        SY: 'Suriah ðŸ‡¸ðŸ‡¾',
        TW: 'Taiwan ðŸ‡¹ðŸ‡¼',
        TJ: 'Tajikistan ðŸ‡¹ðŸ‡¯',
        TZ: 'Tanzania ðŸ‡¹ðŸ‡¿',
        TH: 'Thailand ðŸ‡¹ðŸ‡­',
        TL: 'Timor-Leste ðŸ‡¹ðŸ‡±',
        TG: 'Togo ðŸ‡¹ðŸ‡¬',
        TK: 'Tokelau ðŸ‡¹ðŸ‡°',
        TO: 'Tonga ðŸ‡¹ðŸ‡´',
        TT: 'Trinidad dan Tobago ðŸ‡¹ðŸ‡¹',
        TN: 'Tunisia ðŸ‡¹ðŸ‡³',
        TR: 'Turki ðŸ‡¹ðŸ‡·',
        TM: 'Turkmenistan ðŸ‡¹ðŸ‡²',
        TC: 'Kepulauan Turks dan Caicos ðŸ‡¹ðŸ‡¨',
        TV: 'Tuvalu ðŸ‡¹ðŸ‡»',
        UG: 'Uganda ðŸ‡ºðŸ‡¬',
        UA: 'Ukraina ðŸ‡ºðŸ‡¦',
        AE: 'Uni Emirat Arab ðŸ‡¦ðŸ‡ª',
        GB: 'Inggris Raya ðŸ‡¬ðŸ‡§',
        US: 'Amerika Serikat ðŸ‡ºðŸ‡¸',
        UM: 'Kepulauan Terluar Kecil Amerika Serikat ðŸ‡ºðŸ‡²',
        UY: 'Uruguay ðŸ‡ºðŸ‡¾',
        UZ: 'Uzbekistan ðŸ‡ºðŸ‡¿',
        VU: 'Vanuatu ðŸ‡»ðŸ‡º',
        VE: 'Venezuela ðŸ‡»ðŸ‡ª',
        VN: 'Vietnam ðŸ‡»ðŸ‡³',
        VG: 'Kepulauan Virgin Britania Raya ðŸ‡»ðŸ‡¬',
        VI: 'Kepulauan Virgin Amerika Serikat ðŸ‡»ðŸ‡®',
        WF: 'Wallis dan Futuna ðŸ‡¼ðŸ‡«',
        EH: 'Sahara Barat ðŸ‡ªðŸ‡­',
        YE: 'Yaman ðŸ‡¾ðŸ‡ª',
        ZM: 'Zambia ðŸ‡¿ðŸ‡²',
        ZW: 'Zimbabwe ðŸ‡¿ðŸ‡¼',
    };


  // Mengembalikan nama region dengan bendera jika ditemukan, atau 'Tidak diketahui' jika tidak
  return regionMap[value] || 'Tidak diketahui';
};

async function stalkFreeFire(id) {
let data = JSON.stringify({
  "app_id": 100067,
  "login_id": id
});

let config = {
  method: 'POST',
  url: 'https://kiosgamer.co.id/api/auth/player_id_login',
  headers: {
    'User-Agent': 'Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Mobile Safari/537.36',
    'Accept': 'application/json, text/plain, */*',
    'Content-Type': 'application/json',
    'sec-ch-ua-platform': '"Android"',
    'sec-ch-ua': '"Chromium";v="134", "Not:A-Brand";v="24", "Google Chrome";v="134"',
    'sec-ch-ua-mobile': '?1',
    'Origin': 'https://kiosgamer.co.id',
    'Sec-Fetch-Site': 'same-origin',
    'Sec-Fetch-Mode': 'cors',
    'Sec-Fetch-Dest': 'empty',
    'Referer': 'https://kiosgamer.co.id/',
    'Accept-Language': 'id-ID,id;q=0.9,en-US;q=0.8,en;q=0.7',
    'Cookie': 'source=mb; region=CO.ID; mspid2=d175049875f78d90e7618f10b5930826; _ga=GA1.1.1096715143.1744003536; language=id; datadome=Oh~Qd6USZYfQps_cIi6V06MyaYyU4M8goxVzxq6lyoLUu6ml9hRkiA6eiMdmFuBr6hwB52PiydIWCRZxWtdE1FQLBGu7nqW5mfbBfXbSLbhg7XlKtPfOVTOzJ4OhLFgm; session_key=4txikks54uzrbj9hz174ic2g8ma0zd2p; _ga_Q7ESEPHPSF=GS1.1.1744003535.1.1.1744004048.0.0.0'
  },
  data: data
};

const api = await axios.request(config);
return api.data;
}
module.exports = function(app) {
  app.get('/stalk/ff', async (req, res) => {
    const { id } = req.query;

    if (!id) {
      return res.status(400).json({
        status: false,
        message: 'Parameter id harus diisi.'
      });
    }

    try {
      const result = await stalkFreeFire(id);

      if (!result.nickname) {
        return res.status(404).json({
          status: false,
          message: 'Data tidak ditemukan. Pastikan ID Free Fire yang dimasukkan benar.'
        });
      }

  
      const nickname = result.nickname || 'Tidak ditemukan';
      const regionCode = (result.region || '').toUpperCase();
      const regionFull = mooCountry(regionCode);
      const flagEmoji = regionFull.match(/[\u{1F1E6}-\u{1F1FF}]{2}/u)?.[0] || '';

      return res.status(200).json({
        status: true,
        nickname,
        region: regionFull,
        region_flag: flagEmoji
      });
    } catch (error) {
      return res.status(500).json({
        status: false,
        message: 'Internal server error',
        error: error.message
      });
    }
  });
};
